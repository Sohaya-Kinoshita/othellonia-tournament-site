<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="icon" href="./images/oc_mark.png" type="image/png">
    <title>ログイン | オセロニアクランバトルホームページ</title>
</head>

<body>
    <div id="headerSlot"></div>

    <main class="auth-shell">
        <div class="auth-card">
            <div class="auth-card-header">
                <p class="auth-eyebrow">オセロニアクランバトル</p>
                <h1>ログイン</h1>
                <p class="auth-lead">大会運営向けのログイン画面です。IDとパスワードを入力してください。</p>
            </div>

            <div class="auth-grid">
                <section class="auth-form">
                    <label class="auth-field">
                        <span>ID</span>
                        <div class="auth-input-row">
                            <input id="userIdInput" class="auth-input" type="text" autocomplete="username"
                                placeholder="admin01" />
                            <span class="auth-spacer" aria-hidden="true"></span>
                        </div>
                    </label>

                    <label class="auth-field">
                        <span>パスワード</span>
                        <div class="auth-password">
                            <input id="passwordInput" class="auth-input" type="password" autocomplete="current-password"
                                placeholder="AdminPass123" />
                            <button id="passwordToggle" class="auth-toggle" type="button" aria-pressed="false">
                                表示
                            </button>
                        </div>
                    </label>

                    <button id="loginButton" class="auth-button" type="button">ログインする</button>

                    <div id="loginMessage" class="auth-message"></div>
                </section>

                <aside class="auth-side">
                    <div class="auth-side-card">
                        <h2>初めての方へ</h2>
                        <p>運営側でID発行を行っています。参加登録やID発行のご相談は公式アカウントへ。</p>
                        <a class="auth-cta" href="https://x.com/OCB_othello" target="_blank" rel="noreferrer">
                            公式Xを開く
                        </a>
                        <p class="auth-help">※ 連絡の際は大会名とユーザー名をお知らせください。</p>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <div id="footerSlot"></div>

    <script src="./js/layout.js"></script>

    <script>
        const loginButton = document.getElementById("loginButton");
        const userIdInput = document.getElementById("userIdInput");
        const passwordInput = document.getElementById("passwordInput");
        const loginMessage = document.getElementById("loginMessage");
        const passwordToggle = document.getElementById("passwordToggle");

        async function doLogin() {
            loginMessage.textContent = "";

            const userId = userIdInput.value.trim();
            const password = passwordInput.value;

            if (!userId || !password) {
                loginMessage.textContent = "IDとパスワードを入力してください．";
                return;
            }

            const response = await fetch("/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId, password }),
            });

            const result = await response.json().catch(() => null);

            if (!response.ok) {
                loginMessage.textContent = result?.message ?? "ログインに失敗しました．";
                return;
            }

            // 成功したらトップへ
            location.href = "./index.html";
        }

        loginButton.addEventListener("click", doLogin);

        passwordToggle.addEventListener("click", () => {
            const isVisible = passwordInput.type === "text";
            passwordInput.type = isVisible ? "password" : "text";
            passwordToggle.textContent = isVisible ? "表示" : "非表示";
            passwordToggle.setAttribute("aria-pressed", (!isVisible).toString());
        });

        // Enterで送信できるように
        passwordInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") doLogin();
        });
    </script>
</body>

</html>